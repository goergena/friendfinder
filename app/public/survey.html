<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery.js"></script>
    <title>Friend Finder Survey</title>
</head>

<body>
    <div class="container">
        <h1>Get set up to find your perfect friends!</h1>
        <form>
            <div class="form-group">
                <label for="name">Name</label>
                <input type="name" class="form-control" id="name" placeholder="Harry Potter">
            </div>
            <div class="form-group">
                <label for="q1">You can find me at the bar every weekend.</label>
                <select class="form-control" id="q1">
                    <option selected>Answer</option>
                    <option value="1">1 Strongly Disagree</option>
                    <option value="2">2 Disagree</option>
                    <option value="3">3 No strong feelings</option>
                    <option value="4">4 Agree</option>
                    <option value="5">5 Strongly Agree</option>
                </select>
            </div>

            <div class="form-group">
                <label for="q2">I live for happy hour.</label>
                <select class="form-control" id="q2">
                    <option selected>Answer</option>
                    <option value="1">1 Strongly Disagree</option>
                    <option value="2">2 Disagree</option>
                    <option value="3">3 No strong feelings</option>
                    <option value="4">4 Agree</option>
                    <option value="5">5 Strongly Agree</option>
                </select>
            </div>

            <div class="form-group">
                <label for="q3">On weekends, I prefer a morning workout to brunch.</label>
                <select class="form-control" id="q3">
                    <option selected>Answer</option>
                    <option value="1">1 Strongly Disagree</option>
                    <option value="2">2 Disagree</option>
                    <option value="3">3 No strong feelings</option>
                    <option value="4">4 Agree</option>
                    <option value="5">5 Strongly Agree</option>
                </select>
            </div>

            <div class="form-group">
                <label for="q4">Game day means we're at our bar or we have tickets.</label>
                <select class="form-control" id="q4">
                    <option selected>Answer</option>
                    <option value="1">1 Strongly Disagree</option>
                    <option value="2">2 Disagree</option>
                    <option value="3">3 No strong feelings</option>
                    <option value="4">4 Agree</option>
                    <option value="5">5 Strongly Agree</option>
                </select>
            </div>

            <div class="form-group">
                <label for="q5">Animated movies and tv shows are for kids.</label>
                <select class="form-control" id="q5">
                    <option selected>Answer</option>
                    <option value="1">1 Strongly Disagree</option>
                    <option value="2">2 Disagree</option>
                    <option value="3">3 No strong feelings</option>
                    <option value="4">4 Agree</option>
                    <option value="5">5 Strongly Agree</option>
                </select>
            </div>
            <div class="form-group">
                <label for="q6">I'm looking for someone to hang out with, but I don't want to deal with your problems. I won't talk about
                    mine, either. </label>
                <select class="form-control" id="q6">
                    <option selected>Answer</option>
                    <option value="1">1 Strongly Disagree</option>
                    <option value="2">2 Disagree</option>
                    <option value="3">3 No strong feelings</option>
                    <option value="4">4 Agree</option>
                    <option value="5">5 Strongly Agree</option>
                </select>
            </div>
            <div class="form-group">
                <label for="q7">I prefer to plan things out, so I'd rather make our plans a week in advance.</label>
                <select class="form-control" id="q7">
                    <option selected>Answer</option>
                    <option value="1">1 Strongly Disagree</option>
                    <option value="2">2 Disagree</option>
                    <option value="3">3 No strong feelings</option>
                    <option value="4">4 Agree</option>
                    <option value="5">5 Strongly Agree</option>
                </select>
            </div>

            <div class="form-group">
                <label for="q8">I am always on time and I hate when people are late.</label>
                <select class="form-control" id="q8">
                    <option selected>Answer</option>
                    <option value="1">1 Strongly Disagree</option>
                    <option value="2">2 Disagree</option>
                    <option value="3">3 No strong feelings</option>
                    <option value="4">4 Agree</option>
                    <option value="5">5 Strongly Agree</option>
                </select>
            </div>

            <div class="form-group">
                <label for="q9">I'd rather lie or change the subject than disagree about something.</label>
                <select class="form-control" id="q9">
                    <option selected>Answer</option>
                    <option value="1">1 Strongly Disagree- hope you're ready for a debate! Let's throw down</option>
                    <option value="2">2 Disagree</option>
                    <option value="3">3 No strong feelings</option>
                    <option value="4">4 Agree</option>
                    <option value="5">5 Strongly Agree- I can't stand conflict and will avoid an argument at all costs</option>
                </select>
            </div>

            <div class="form-group">
                <label for="q10">Let's go on vacation together!</label>
                <select class="form-control" id="q10">
                    <option selected>Answer</option>
                    <option value="1">1 Strongly Disagree</option>
                    <option value="2">2 Disagree</option>
                    <option value="3">3 No strong feelings</option>
                    <option value="4">4 Agree</option>
                    <option value="5">5 Strongly Agree</option>
                </select>
            </div>

        </form>
        <button class="btn btn-primary" type="submit" id="submit">Submit form</button>
    </div>


    <script type="text/javascript">
        // In this code below we create the Front-end JavaScript which "POSTS" our form data to our express server.
        // In essence, when the user hits submit, jQuery grabs all of the fields then sends a post request to our api
        // Our api recognizes the route (/api/tables)... and then runs the associated code (found in api-routes.js).
        // In this case the associated code "saves" the data to the table-data.js file or waitinglist-data.js file

        $("#submit").on("click", function (event) {

            var currentURL = window.location.origin;

            // Here we grab the form elements
            var newFriend = {
                name: $("#name").val().trim(),
                scores: [$("#q1").val().trim(),
                    $("#q2").val().trim(),
                    $("#q3").val().trim(),
                    $("#q4").val().trim(),
                    $("#q5").val().trim(),
                    $("#q6").val().trim(),
                    $("#q7").val().trim(),
                    $("#q8").val().trim(),
                    $("#q9").val().trim(),
                    $("#q10").val().trim(),
                ]
            };

            console.log(newFriend);

            $.ajax({
                    url: currentURL + "/api/friends",
                    method: "GET"
                })
                .then(function (friendsData) {

                    // Here we are logging the URL so we have access to it for troubleshooting
                    console.log("------------------------------------");
                    console.log("URL: " + currentURL + "/api/friends");

                    var friendDifferences = [];
                    var winner = 50;
                    for (var friendIndex = 0; friendIndex < friendsData.length; friendIndex++) {
                        //counter++;

                        var currentFriendScore = 0;

                        for (var scoreIndex = 0; scoreIndex < friendsData[friendIndex].scores.length; scoreIndex++) {
                            currentFriendScore += Math.abs(newFriend.scores[scoreIndex] - friendsData[
                                friendIndex].scores[
                                scoreIndex]);

                        };

                        friendDifferences[friendIndex] = currentFriendScore;

                        if (friendIndex > 0) {
                            if (friendDifferences[friendIndex] < winner) {
                                winner = friendDifferences[friendIndex];
                            }
                        }

                    }

                    var newBestie = friendsData[friendDifferences.indexOf(winner)].name;
                    console.log("New bestie: " + newBestie);


                });


            $.post("/api/friends", newFriend)
                .then(function (data) {
                    console.log("adding to friends: ", data);
                    
                });

        });
    </script>
</body>

</html>